<div class="card mt-2">
    <div class="card-header">
        <h5><i class="fa fa-image"></i> รูปภาพ</h5>
    </div>
    <div class="card-body">
        @if ((int)ViewData["id"] == 0)
        {
            <div class="row">
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <div class="custom-file">
                            <input type="file" multiple="" class="custom-file-input" id="file" aria-describedby="file" onchange="BrowsFile();">
                            <label class="custom-file-label" for="file">Choose file</label>
                        </div>
                    </div>
                </div>
            </div>
        }
        <div class="list-img" id="SelectImg">
            @if((int)ViewData["id"] != 0)
            {
                foreach (var image in (List<UseCar.ViewModels.ImageDisplay>)ViewData["imageDisplay"])
                {
                    <div class="item-img">
                        <div class="card">
                            <img src="@image.image" />
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</div>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script>
    var file = [];
    var deleteFile = [];
    $(document).ready(function () {

    });
    function BrowsFile() {
        var files = $('#file')[0].files;
        for (var i = 0; i < files.length; i++) {
            var _id = file.length == 0 ? 1 : file[file.length - 1].id + 1;
            file.push({
                id: _id,
                file: files[i],
                imageId: 0,
                newFile: true
            });
            GenerateFile(files[i], _id, true);
        }
    }
    function GenerateFile(file, id, newFile) {
        var imageId = $('#SelectImg > div').length + 1;
        var _element = '';
        _element += '<div class="item-img">';
        _element += '<div class="card">';
        _element += '<img src = "" id="img_' + imageId + '" />';
        _element += '<div class="card-body">';
        _element += '<div class="row">';
        _element += '<div class="col-md-12">';
        _element += '<button type="button" class="btn btn-danger" onclick="DeleteFile(' + id + ',' + newFile + ')">ลบ</button>';
        _element += '</div>';
        _element += '</div>';
        _element += '</div>';
        _element += '</div>';
        _element += '</div>';
        $('#SelectImg').append(_element);
        $("#img_" + imageId).attr('src', newFile ? window.URL.createObjectURL(file) : file);
    }
    function DeleteFile(id, oldFile) {
        var _removeFile = file.findIndex(function (data) {
            return data.id == id
        });
        if (oldFile) {
            deleteFile.push(file[_removeFile].imageId);
            file.splice(_removeFile, 1);
            $('#SelectImg > div').remove();
            file.forEach(function (file) {
                GenerateFile(file.file, file.id, file.newFile);
            })
        } else {
            file.splice(_removeFile, 1);
            $('#SelectImg > div').remove();
            file.forEach(function (file) {
                GenerateFile(file.file, file.id, file.newFile);
            })
        }
    }
</script>
